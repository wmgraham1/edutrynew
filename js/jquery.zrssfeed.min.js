(function(i){i.fn.rssfeed=function(n,b,u){b=i.extend({limit:10,offset:1,header:!0,titletag:"h4",date:!0,content:!0,snippet:!0,media:!0,showerror:!0,errormsg:"",key:null,ssl:!1,linktarget:"_self",linkredirect:"",linkcontent:!1,sort:"",sortasc:!0},b);return this.each(function(v,o){var s=i(o),a="";b.ssl&&(a="s");s.hasClass("rssFeed")||s.addClass("rssFeed");if(null==n)return!1;0<b.offset&&(b.offset-=1);b.limit+=b.offset;a="http"+a+"://ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=?&q="+encodeURIComponent(n);
a+="&num="+b.limit;null!=b.key&&(a+="&key="+b.key);i.getJSON(a+"&output=json_xml",function(g){if(g.responseStatus==200){var a=g.responseData,e=b;if(g=a.feed){var f=[],c=0,j="",t="odd";if(e.media){var m=a.xmlString;if(navigator.appName=="Microsoft Internet Explorer"){c=new ActiveXObject("Microsoft.XMLDOM");c.async="false";c.loadXML(m)}else c=(new DOMParser).parseFromString(m,"text/xml");m=c.getElementsByTagName("item")}e.header&&(j=j+('<div class="rssHeader"><a href="'+g.link+'" title="'+g.description+
'">'+g.title+"</a></div>"));j=j+'<div class="rssBody"><ul>';for(a=e.offset;a<g.entries.length;a++){c=a-e.offset;f[c]=[];var d=g.entries[a],k,l="",h=d.link;switch(e.sort){case "title":l=d.title;break;case "date":l=d.publishedDate}f[c].sort=l;if(d.publishedDate){k=new Date(d.publishedDate);k=k.toLocaleDateString()+" "+k.toLocaleTimeString()}e.linkredirect&&(h=encodeURIComponent(h));f[c].html="<"+e.titletag+'><a href="'+e.linkredirect+h+'" title="View this feed at '+g.title+'">'+d.title+"</a></"+e.titletag+
">";e.date&&k&&(f[c].html=f[c].html+("<div>"+k+"</div>"));if(e.content){d=e.snippet&&d.contentSnippet!=""?d.contentSnippet:d.content;e.linkcontent&&(d='<a href="'+e.linkredirect+h+'" title="View this feed at '+g.title+'">'+d+"</a>");f[c].html=f[c].html+("<p>"+d+"</p>")}if(e.media&&m.length>0){h=m[a].getElementsByTagName("enclosure");if(h.length>0){f[c].html=f[c].html+'<div class="rssMedia"><div>Media files</div><ul>';for(d=0;d<h.length;d++){var p=h[d].getAttribute("url"),q=h[d].getAttribute("type"),
r=h[d].getAttribute("length"),l=f[c],n=l.html,p='<li><a href="'+p+'" title="Download this media">'+p.split("/").pop()+"</a> ("+q+", ",q=Math.floor(Math.log(r)/Math.log(1024)),r=(r/Math.pow(1024,Math.floor(q))).toFixed(2)+" "+["bytes","kb","MB","GB","TB","PB"][q];l.html=n+(p+r+")</li>")}f[c].html=f[c].html+"</ul></div>"}}}e.sort&&f.sort(function(c,d){if(e.sortasc)var a=c.sort,b=d.sort;else{a=d.sort;b=c.sort}if(e.sort=="date")return new Date(a)-new Date(b);a=a.toLowerCase();b=b.toLowerCase();return a<
b?-1:a>b?1:0});i.each(f,function(a){j=j+('<li class="rssRow '+t+'">'+f[a].html+"</li>");t=t=="odd"?"even":"odd"});j=j+"</ul></div>";i(o).html(j);i("a",o).attr("target",e.linktarget)}i.isFunction(u)&&u.call(this,s)}else{b.showerror&&(c=b.errormsg!=""?b.errormsg:g.responseDetails);i(o).html('<div class="rssError"><p>'+c+"</p></div>")}})})}})(jQuery);